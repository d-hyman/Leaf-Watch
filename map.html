<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA NDVI World Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .map-container {
            width: 100%;
            max-width: 1200px;
            height: 600px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border: 3px solid rgba(255,255,255,0.2);
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .controls {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 20px;
            max-width: 1200px;
            width: 100%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .control-group label {
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }
        
        .control-group input,
        .control-group select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        
        button {
            padding: 10px 20px;
            background: #2d5a3d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #1a472a;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .info-box {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 20px;
            max-width: 1200px;
            width: 100%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .info-box h3 {
            color: #2d5a3d;
            margin-bottom: 10px;
        }
        
        .info-box p {
            color: #333;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .legend h4 {
            margin: 0 0 10px 0;
            font-size: 0.9em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 0.85em;
        }
        
        .legend-color {
            width: 30px;
            height: 15px;
            margin-right: 8px;
            border: 1px solid #ccc;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
        }
        
        .loading.active {
            display: block;
        }

        .status-message {
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        .date-suggestions {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <header>
        <h1>üåç NASA NDVI World Map</h1>
        <p class="subtitle">Normalized Difference Vegetation Index - Global Vegetation Health</p>
    </header>
    
    <div class="map-container">
        <div id="map"></div>
        <div class="legend">
            <h4>NDVI Scale</h4>
            <div class="legend-item">
                <div class="legend-color" style="background: #8B4513;"></div>
                <span>-1.0 to -0.1 (Water/Snow)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #D2B48C;"></div>
                <span>0.0 to 0.2 (Bare Soil)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #F0E68C;"></div>
                <span>0.2 to 0.4 (Sparse Veg)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #90EE90;"></div>
                <span>0.4 to 0.6 (Moderate Veg)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #228B22;"></div>
                <span>0.6 to 0.8 (Dense Veg)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #006400;"></div>
                <span>0.8 to 1.0 (Very Dense)</span>
            </div>
        </div>
        <div class="loading" id="loading">
            <p>Loading NDVI data...</p>
        </div>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label for="dateInput">Date (YYYY-MM-DD):</label>
            <input type="date" id="dateInput" value="2023-07-01">
            <div class="date-suggestions">Try: 2023-07-01, 2023-01-01, 2024-06-01</div>
        </div>
        <div class="control-group">
            <label for="productSelect">Satellite Product:</label>
            <select id="productSelect">
                <option value="MODIS_Terra_NDVI_8Day">MODIS Terra NDVI (8-Day)</option>
                <option value="MODIS_Aqua_NDVI_8Day">MODIS Aqua NDVI (8-Day)</option>
                <option value="VIIRS_NOAA20_NDVI_8Day">VIIRS NOAA-20 NDVI (8-Day)</option>
            </select>
        </div>
        <button id="loadBtn">Load NDVI Data</button>
    </div>

    <div class="info-box">
        <div id="statusMessage" class="status-message"></div>
        <h3>About NDVI (Normalized Difference Vegetation Index)</h3>
        <p><strong>What is NDVI?</strong> NDVI is a numerical indicator that uses the visible and near-infrared bands of the electromagnetic spectrum to analyze remote sensing measurements and assess whether the target being observed contains live green vegetation.</p>
        <p><strong>Scale:</strong> NDVI values range from -1 to +1. Higher values (0.6-0.9) indicate dense, healthy vegetation. Lower values (0.2-0.4) indicate sparse vegetation, and values near 0 or negative indicate non-vegetated surfaces like water, snow, or bare soil.</p>
        <p><strong>Data Source:</strong> NASA MODIS (Moderate Resolution Imaging Spectroradiometer) and VIIRS (Visible Infrared Imaging Radiometer Suite) satellites provide global NDVI data through NASA's GIBS (Global Imagery Browse Services).</p>
        <p><strong>How to use:</strong> Select a date and satellite product, then click "Load NDVI Data". The imagery updates every 8 days. Dates must align with available satellite passes. Click anywhere on the map to see estimated NDVI values.</p>
        <p><strong>Note:</strong> GIBS is an open service and does not require authentication. If data doesn't load, try a date from early-to-mid 2023 or 2024.</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
// Initialize the map
const map = L.map('map').setView([20, 0], 2);

// Add base OpenStreetMap layer
const baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors',
    maxZoom: 19,
    minZoom: 2
}).addTo(map);

let ndviLayer = null;
let errorShown = false;

// Function to get NDVI color based on value
function getNDVIColor(value) {
    if (value < 0) return '#8B4513';
    if (value < 0.2) return '#D2B48C';
    if (value < 0.4) return '#F0E68C';
    if (value < 0.6) return '#90EE90';
    if (value < 0.8) return '#228B22';
    return '#006400';
}

// Function to show status message
function showStatus(message, type) {
    const statusEl = document.getElementById('statusMessage');
    statusEl.textContent = message;
    statusEl.className = `status-message ${type}`;
    
    if (type === 'success' || type === 'info') {
        setTimeout(() => {
            statusEl.className = 'status-message';
        }, 5000);
    }
}

// Function to load NDVI layer from NASA GIBS
function loadNDVILayer() {
    const dateInput = document.getElementById('dateInput').value;
    const date = dateInput.replace(/-/g, '');
    const product = document.getElementById('productSelect').value;
    const loading = document.getElementById('loading');
    
    if (!dateInput) {
        showStatus('Please select a date', 'error');
        return;
    }
    
    loading.classList.add('active');
    showStatus('Loading NDVI data...', 'info');
    
    // Remove existing NDVI layer if present
    if (ndviLayer) {
        map.removeLayer(ndviLayer);
    }
    
    // NASA GIBS WMTS endpoint - note these are OPEN and don't require auth
    const gibsUrl = `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/${product}/default/${date}/GoogleMapsCompatible_Level9/{z}/{y}/{x}.png`;
    
    ndviLayer = L.tileLayer(gibsUrl, {
        attribution: 'NASA EOSDIS GIBS',
        maxZoom: 9,
        minZoom: 2,
        opacity: 0.75,
        tileSize: 256
    });
    
    let tilesLoaded = 0;
    let tilesErrored = 0;
    
    ndviLayer.on('tileloadstart', function() {
        // Track loading
    });
    
    ndviLayer.on('tileload', function() {
        tilesLoaded++;
        if (tilesLoaded === 1) {
            loading.classList.remove('active');
            showStatus(`NDVI data loaded successfully for ${dateInput}!`, 'success');
            errorShown = false;
        }
    });
    
    ndviLayer.on('tileerror', function(error) {
        tilesErrored++;
        console.error('Tile loading error:', error);
        
        if (tilesErrored === 3 && tilesLoaded === 0) {
            loading.classList.remove('active');
            if (!errorShown) {
                errorShown = true;
                showStatus(`No NDVI data available for ${dateInput}. Try dates from 2023 like 2023-07-01, 2023-01-01, or 2024-06-01. Data is available every 8 days.`, 'error');
            }
        }
    });
    
    ndviLayer.addTo(map);
    
    // Timeout fallback
    setTimeout(() => {
        if (tilesLoaded === 0) {
            loading.classList.remove('active');
            if (!errorShown) {
                errorShown = true;
                showStatus(`Could not load data for ${dateInput}. MODIS/VIIRS data may not be available for this specific date. Try 2023-07-01 or check NASA Worldview for available dates.`, 'error');
            }
        }
    }, 8000);
}

// Add click event to show coordinates and estimated NDVI
map.on('click', function(e) {
    const lat = e.latlng.lat.toFixed(4);
    const lng = e.latlng.lng.toFixed(4);
    
    // Simulate NDVI value based on latitude and climate zones
    let estimatedNDVI = 0;
    const absLat = Math.abs(e.latlng.lat);
    
    if (absLat < 10) {
        estimatedNDVI = 0.6 + Math.random() * 0.3;
    } else if (absLat < 30) {
        estimatedNDVI = 0.3 + Math.random() * 0.4;
    } else if (absLat < 60) {
        estimatedNDVI = 0.4 + Math.random() * 0.3;
    } else {
        estimatedNDVI = 0.1 + Math.random() * 0.2;
    }
    
    const ndviValue = estimatedNDVI.toFixed(3);
    const color = getNDVIColor(parseFloat(ndviValue));
    
    L.popup()
        .setLatLng(e.latlng)
        .setContent(`
            <b>Location</b><br>
            Latitude: ${lat}<br>
            Longitude: ${lng}<br>
            <br>
            <b style="color: ${color}">Estimated NDVI: ${ndviValue}</b><br>
            <small>(Simulated based on latitude)</small>
        `)
        .openOn(map);
});

// Load button event
document.getElementById('loadBtn').addEventListener('click', function() {
    errorShown = false;
    loadNDVILayer();
});

// Set reasonable date limits
const today = new Date();
const maxDate = new Date(today.getFullYear(), today.getMonth() - 2, 1);
document.getElementById('dateInput').max = maxDate.toISOString().split('T')[0];
document.getElementById('dateInput').min = '2000-01-01';

// Load initial NDVI layer
loadNDVILayer();

// Add some example markers for reference locations
const referenceLocations = [
    { name: 'Amazon Rainforest', coords: [-3.4653, -62.2159], type: 'Dense Vegetation' },
    { name: 'Sahara Desert', coords: [23.4162, 25.6628], type: 'Sparse Vegetation' },
    { name: 'Greenland Ice Sheet', coords: [72.0, -40.0], type: 'Ice/Snow' },
    { name: 'Great Plains, USA', coords: [41.8781, -103.4595], type: 'Agricultural' }
];

referenceLocations.forEach(location => {
    L.marker(location.coords)
        .addTo(map)
        .bindPopup(`<b>${location.name}</b><br><i>${location.type}</i>`);
});
    </script>
</body>
</html>